{% extends "dashboard_base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="custom-card text-center">
            <div class="map-container" style="background-color: white; overflow: hidden;">
                 <img src="{{ url_for('static', filename='denah_baru.png') }}" 
                     alt="Denah Lokasi" style="height: 100%; width: auto; object-fit: contain;">
            </div>
            <h5 class="mt-2">Denah</h5>
        </div>
    </div>
</div>

<div class="row">
    
    {% if mode == 'MONITOR' %}
    
        <div class="col-12">
            <div class="custom-card {% if status_code == 107 %}border-danger{% else %}border-primary{% endif %}">
                <div class="text-center py-4">
                    
                    {% if status_code == 107 %}
                        <h2 class="text-danger fw-bold">KENDALA PADA ROBOT</h2>
                        <p class="text-danger">Salah satu komponen Hardware tidak aktif/rusak.</p>
                    {% else %}
                        <h2 class="text-primary fw-bold">ROBOT SEDANG SIBUK</h2>
                    {% endif %}
                    
                    <hr>
                    <div class="row">
                        <div class="col-md-4">
                            <h5>Status:</h5>
                            {% if status_code == 104 %}
                                <span class="badge bg-warning text-dark fs-5">MENGANTAR PAKET</span>
                            {% elif status_code == 105 %}
                                <span class="badge bg-success fs-5">SAMPAI TUJUAN</span>
                            {% elif status_code == 106 %}
                                <span class="badge bg-info text-dark fs-5">PULANG KE STATION</span>
                            {% elif status_code == 107 %}
                                <span class="badge bg-danger fs-5">ERROR / INACTIVE</span>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <h5>Tujuan:</h5>
                            <h3 class="fw-bold">{{ tujuan }}</h3>
                        </div>
                        <div class="col-md-4">
                            <h5>Rute Aktif:</h5>
                            <small>{{ rute }}</small>
                        </div>
                    </div>
                    
                    <p class="mt-3 text-muted">
                        {% if status_code == 107 %}
                            Harap periksa koneksi hardware (ESP32/Camera/WiFi) pada Mockup DB.
                        {% else %}
                            Form input dikunci hingga robot kembali ke Station (Status 103).
                        {% endif %}
                    </p>
                    
                    <meta http-equiv="refresh" content="3"> 
                </div>
            </div>
        </div>

    {% else %}
    
        <div class="col-md-6">
            <div class="custom-card h-100">
                <form method="POST" action="{{ url_for('views.send_page') }}">
                    <div class="mb-3 row">
                        <label class="col-sm-5 col-form-label fw-bold">Pilihan Pengiriman:</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" name="pilihan" 
                                   placeholder="Kode Ruang (Cth: 11A)" maxlength="3" required>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-5 col-form-label fw-bold">Nama:</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" name="nama" placeholder="Nama Pengirim" required>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end mt-4">
                         <button type="submit" class="btn btn-primary px-4">Kalkulasi & Kirim</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="custom-card h-100 d-flex flex-column">
                <div class="mt-3">
                    <h6 class="fw-bold">Kalkulasi Rute:</h6>
                    {% if status_rute %}
                        <h4 class="{{ warna_status }} fw-bold mb-3">{{ status_rute }}</h4>
                    {% else %}
                        <h4 class="text-secondary fw-bold">MENUNGGU INPUT...</h4>
                    {% endif %}
                </div>
            </div>
        </div>
        
    {% endif %}
</div>
{% endblock %}